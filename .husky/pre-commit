#!/bin/sh

# Exit on error
set -e

echo "ğŸ” Running pre-commit checks..."

# Run lint-staged for automatic fixes and checks
echo "ğŸ¨ Running lint-staged..."
npx lint-staged

# Run tests based on changed files
if git diff --cached --name-only | grep -q "^server/"; then
  echo "ğŸ§ª Running server tests..."
  cd server
  npm test
  cd ..
fi

if git diff --cached --name-only | grep -q "^ios/"; then
  echo "ğŸ§ª Running iOS tests..."
  cd ios
  swift test
  cd ..
fi

# Run security audit
echo "ğŸ”’ Running security audit..."
cd server && npm audit --audit-level=high
cd ..

echo "âœ… Pre-commit checks completed!"
