#!/bin/sh

# Exit on error
set -e

echo "🔍 Running pre-commit checks..."

# Run lint-staged for automatic fixes and checks
echo "🎨 Running lint-staged..."
npx lint-staged

# Run tests based on changed files
if git diff --cached --name-only | grep -q "^server/"; then
  echo "🧪 Running server tests..."
  cd server
  npm test
  cd ..
fi

if git diff --cached --name-only | grep -q "^ios/"; then
  echo "🧪 Running iOS tests..."
  cd ios
  swift test
  cd ..
fi

# Run security audit
echo "🔒 Running security audit..."
cd server && npm audit --audit-level=high
cd ..

echo "✅ Pre-commit checks completed!"
